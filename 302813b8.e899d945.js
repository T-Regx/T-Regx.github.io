(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{132:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return c})),a.d(t,"default",(function(){return s}));var n=a(1),r=(a(0),a(204));const i={title:"Release 0.9.7 - Match as vanilla array!",author:"Daniel Wilkowski",authorFBID:0x5af34da0d14b},o={permalink:"/blog/2020/04/08/release-0.9.7",source:"@site/blog/2020-04-08-release-0.9.7.md",description:"There was a lot of changes in the code, so I reckon we could release twice in the same week, because why not :)",date:"2020-04-08T00:00:00.000Z",tags:[],title:"Release 0.9.7 - Match as vanilla array!",readingTime:1.755,truncated:!1,prevItem:{title:"Release 0.9.8 - foreach baby, foreach!",permalink:"/blog/2020/04/13/release-0.9.8"},nextItem:{title:"Release 0.9.6 - First/all changes!",permalink:"/blog/2020/04/02/release-0.9.6"}},c=[{value:"The concept",id:"the-concept",children:[]},{value:"The idea",id:"the-idea",children:[]},{value:"The solution",id:"the-solution",children:[]}],l={rightToc:c};function s({components:e,...t}){return Object(r.b)("wrapper",Object(n.a)({},l,t,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"There was a lot of changes in the code, so I reckon we could release twice in the same week, because why not :)"),Object(r.b)("p",null,"So what are the changes?"),Object(r.b)("p",null,"Bare with me."),Object(r.b)("h3",{id:"the-concept"},"The concept"),Object(r.b)("p",null,"Capturing groups in T-Regx have a really rich API (probably the richest out there), with a lot of variables.\nMost importantly T-Regx handles:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Invalid groups")," (e.g. negative index ",Object(r.b)("inlineCode",{parentName:"li"},"-1")," or malformed group ",Object(r.b)("inlineCode",{parentName:"li"},"!@#$"),"), which always throw exception"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Missing groups")," (e.g. group ",Object(r.b)("inlineCode",{parentName:"li"},"4")," used in pattern, that only has 2 groups; same for named) which conditionally throws exceptions"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Optional groups")," (e.g. ",Object(r.b)("inlineCode",{parentName:"li"},"(origin/)?master"),"), which is really tricky to distinguish with PCRE"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Matched groups")," (which can be tricky, if the matched group is an empty string ",Object(r.b)("inlineCode",{parentName:"li"},'""'),")")),Object(r.b)("p",null,"Because of that, syntax of groups is not the shortest:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),"pattern('(origin/)?master')->match('master')->first(function (Match $match) {\n    $match->group(1)->text(); // for example\n});\n")),Object(r.b)("p",null,"But we know that T-Regx users mostly care about the last group, ",Object(r.b)("strong",{parentName:"p"},"Matched groups"),", so they would like to use them\nwith as simple syntax as possible. That makes sense."),Object(r.b)("h3",{id:"the-idea"},"The idea"),Object(r.b)("p",null,"At first, there was an idea of ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/match"}),Object(r.b)("inlineCode",{parentName:"a"},"Match"))," details implementing ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.php.net/manual/en/class.arrayaccess.php"}),Object(r.b)("inlineCode",{parentName:"a"},"\\ArrayAccess")),", so this syntax would be possible:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),"pattern('(origin/)?master')->match('master')->first(function (Match $match) {\n    $match[1]; // same as above\n});\n")),Object(r.b)("p",null,"Well, that syntax does look good, at first, but it comes at a price. A high price."),Object(r.b)("p",null,"Why we ditched the ",Object(r.b)("inlineCode",{parentName:"p"},"\\ArrayAccess")," idea:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Unnecessary ",Object(r.b)("inlineCode",{parentName:"li"},"set")," and ",Object(r.b)("inlineCode",{parentName:"li"},"unset")," methods"),Object(r.b)("li",{parentName:"ul"},"Methods that work for arrays (",Object(r.b)("inlineCode",{parentName:"li"},"array_key_exist()"),") won't work with ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.php.net/manual/en/class.arrayaccess.php"}),Object(r.b)("inlineCode",{parentName:"a"},"\\ArrayAccess"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"empty($match[1])")," returns ",Object(r.b)("inlineCode",{parentName:"li"},"true"),", even if the group ",Object(r.b)("inlineCode",{parentName:"li"},"1")," was matched (",Object(r.b)("inlineCode",{parentName:"li"},'""')," and ",Object(r.b)("inlineCode",{parentName:"li"},'"0"')," ",Object(r.b)("strong",{parentName:"li"},"yes")," is falsy)"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"isset($match[-2])")," couldn't throw an exception for a malformed group"),Object(r.b)("li",{parentName:"ul"},"There's a bug in PHP, that causes ",Object(r.b)("inlineCode",{parentName:"li"},"$match['100']")," to be treated as ",Object(r.b)("inlineCode",{parentName:"li"},"$match[100]")," (cast to ",Object(r.b)("inlineCode",{parentName:"li"},"int")," any numeric value).")),Object(r.b)("h3",{id:"the-solution"},"The solution"),Object(r.b)("p",null,"So, instead, we got an idea: What if ",Object(r.b)("inlineCode",{parentName:"p"},"$match")," was a real PHP ",Object(r.b)("inlineCode",{parentName:"p"},"array"),". Every method or notation that works\nfor arrays, will also work."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),"pattern('(origin/)?master')->match('master')->asArray()->first(function (array $match) {\n    $match[1]; // same as above\n});\n")),Object(r.b)("p",null,"The structure of the array is perfectly identical to what ",Object(r.b)("inlineCode",{parentName:"p"},"preg_match()")," would return :)"))}s.isMDXComponent=!0},204:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c({},t,{},e)),a},p=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=Object(n.forwardRef)((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(a),h=n,m=p["".concat(o,".").concat(h)]||p[h]||u[h]||i;return a?r.a.createElement(m,c({ref:t},s,{components:a})):r.a.createElement(m,c({ref:t},s))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=h;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var s=2;s<i;s++)o[s]=a[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);